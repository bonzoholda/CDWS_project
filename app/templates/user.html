<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layanan Periksa Tagihan</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <div class="form-container">
    <h1>Lihat Tagihan Saya</h1>
    <form action="/user" method="get">
        <label for="user_id">Masukkan ID Pelanggan:</label>
        <input type="text" name="user_id" required>
        <button type="submit">Periksa</button>
    </form>
    </div>
        
    {% if user_data %}
        <h2>Tagihan: {{ user_data[0].user_name }}</h2>
        <div class="table-wrapper">
        <table class="bill-table">

            <thead>
                <tr>
                    <th>Periode</th>
                    <th>Nomor SR</th>
                    <th>Alamat</th>
                    <th>Meter Lalu</th>
                    <th>Meter Sekarang</th>
                    <th>Pemakaian</th>
                    <th>Biaya 01-10</th>
                    <th>Biaya 11-20</th>
                    <th>Biaya 21-30</th>
                    <th>Biaya di atas 30</th>
                    <th>Beban Dasar</th>
                    <th>Jumlah Tagihan</th>
                </tr>
            </thead>

            <tbody>
                {% for bill in user_data %}
                <tr class="card-row">
                  <td>
                    <div class="card-line">
                      <span class="card-label">Periode</span>
                      <span class="card-value">{{ bill.pay_period }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Nomor SR</span>
                      <span class="card-value">{{ bill.device_id }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Alamat</span>
                      <span class="card-value">{{ bill.user_address }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Meter Lalu</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.meter_past|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Meter Sekarang</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.meter_now|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Pemakaian</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.usage|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Biaya 01-10</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.lv1_cost|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Biaya 11-20</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.lv2_cost|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Biaya 21-30</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.lv3_cost|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Biaya di atas 30</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.lv4_cost|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Beban Dasar</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.basic_cost|float) }}</span>
                    </div>
                    <div class="card-line">
                      <span class="card-label">Jumlah Tagihan</span>
                      <span class="card-value">{{ "{:,.0f}".format(bill.bill_amount|float) }}</span>
                    </div>
                  </td>
                </tr>

                {% endfor %}
            </tbody>

        </table>
        </div>
        <h3>Total belum terbayar: {{ user_data | map(attribute='bill_amount') | sum }}</h3>
    {% elif user_id %}
        <p>Tagihan untuk pelanggan dengan ID {{ user_id }}.</p>
    {% endif %}
</body>
</html>
