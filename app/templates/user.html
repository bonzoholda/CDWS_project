<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layanan Periksa Tagihan</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <div class="form-container">
    <h1>Lihat Tagihan Saya</h1>
    <form action="/user" method="get">
        <label for="user_id">Masukkan ID Pelanggan:</label>
        <input type="text" name="user_id" required>
        <button type="submit">Periksa</button>
    </form>
    </div>
        
    {% if user_data %}
        <h2>Tagihan: {{ user_data[0].user_name }}</h2>
        <div class="table-wrapper">
        <table class="bill-table">

            <thead>
                <tr>
                    <th>Periode</th>
                    <th>Nomor SR</th>
                    <th>Alamat</th>
                    <th>Meter Lalu</th>
                    <th>Meter Sekarang</th>
                    <th>Pemakaian</th>
                    <th>Biaya 01-10</th>
                    <th>Biaya 11-20</th>
                    <th>Biaya 21-30</th>
                    <th>Biaya di atas 30</th>
                    <th>Beban Dasar</th>
                    <th>Jumlah Tagihan</th>
                </tr>
            </thead>

            <tbody>
                {% for bill in user_data %}
                <tr>
                    <td data-label="Periode"><span>{{ bill.pay_period }}</span></td>
                    <td data-label="Nomor SR"><span>{{ bill.device_id }}</span></td>
                    <td data-label="Alamat"><span>{{ bill.user_address }}</span></td>
                    <td data-label="Meter Lalu"><span>{{ bill.meter_past }}</span></td>
                    <td data-label="Meter Sekarang"><span>{{ bill.meter_now }}</span></td>
                    <td data-label="Pemakaian"><span>{{ bill.usage }}</span></td>
                    <td data-label="Biaya 01-10"><span>{{ bill.lv1_cost }}</span></td>
                    <td data-label="Biaya 11-20"><span>{{ bill.lv2_cost }}</span></td>
                    <td data-label="Biaya 21-30"><span>{{ bill.lv3_cost }}</span></td>
                    <td data-label="Biaya di atas 30"><span>{{ bill.lv4_cost }}</span></td>
                    <td data-label="Beban Dasar"><span>{{ "{:,.0f}".format(bill.basic_cost) }}</span></td>
                    <td data-label="Jumlah Tagihan">
  <span>{{ "{:,.0f}".format(bill.bill_amount) }}</span>
</td>

                </tr>
                {% endfor %}
            </tbody>

        </table>
        </div>
        <h3>Total Due: {{ user_data | map(attribute='bill_amount') | sum }}</h3>
    {% elif user_id %}
        <p>Tagihan untuk pelanggan dengan ID {{ user_id }}.</p>
    {% endif %}
</body>
</html>
